<!DOCTYPE html>
<html>
  <head>
    <title>WeboPAN [% IF title %] :: [% title %] [% END %]</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, charset=[% settings.charset %]">
    [% css_tags %]

  </head>
  <body>
    <div class="navbar navbar-static-top navbar-inverse">
      <div class="navbar-inner">
        <a class="brand" href="[% request.uri_for("/") %]">WeboPAN</a>
        <ul class="nav">
          <li class="active"><a href="#">Foo</a></li>
          <li><a href="#">Bar</a></li>
          <li><a href="#">Baz</a></li>
        </ul>
        <form class="navbar-search pull-right">
          <input type="text" class="search-module-names search-query" autocomplete="off"
                 placeholder="Search by module name">
        </form>
      </div>
    </div>
    <div class="container-fluid">
      [% content %]
    </div>
    [% js_tags %]
    <script>
      <!-- TODO find a better place to put this -->
$(document).ready(function() {
    $(".search-module-names").typeahead({
        minLength: 3,
        source: function(query, process) {
            $.getJSON("[% request.uri_base %]/module-search/json", { q: query }, function(data) {
                labels = [];
                mapped = {};
                $.each(data, function(i,item) {
                    mapped[item.label] = item.url;
                    labels.push(item.label);
                });
                process(labels);
            });
        },
        updater: function (item) {
            if (mapped[item] === undefined) {
                document.location = "[% request.uri_for("/module-search") %]" + '?q=' + encodeURIComponent(item);
            } else {
                document.location = mapped[item];
            }
            return item;
        },
        sorter: function (items) {
            items.unshift(this.query);
            return items;
        }
    });
});
    </script>
  </body>
</html>
